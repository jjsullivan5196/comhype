<script>
var ws;

globalThis.cmd = function(command) {
    ws.send(command);
}

globalThis.reconnect = function() {
    function __eval(code) {
	import(`data:text/javascript,/*${crypto.randomUUID()}*/${code}`);
    }

    try {
	ws && ws.close();
	
	ws = new WebSocket("/");

	ws.addEventListener("message", function (event) {
	    (typeof event.data === "string") && __eval(event.data);
	});

	ws.addEventListener("error", reconnect);

	ws.addEventListener("open", function() {
	    cmd('["client-alive"]');
	});
    }
    catch {}
}

reconnect();
document.currentScript.remove();  
</script>
